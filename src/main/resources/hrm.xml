<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hrproject.hrproject.dao.HrmDao">

<!--    <sql id="search">-->
<!--        <choose>-->
<!--            <when test="search == 'empno'">-->
<!--                empno LIKE CONCAT('%', #{searchWord}, '%')-->
<!--            </when>-->
<!--            <when test="search == 'ename'">-->
<!--                ename LIKE CONCAT('%', #{searchWord}, '%')-->
<!--            </when>-->
<!--            <when test="search == 'deptname'">-->
<!--                deptname LIKE CONCAT('%', #{searchWord}, '%')-->
<!--            </when>-->
<!--            <when test="search == 'email'">-->
<!--                email LIKE CONCAT('%', #{searchWord}, '%')-->
<!--            </when>-->
<!--            <otherwise>-->
<!--                empno LIKE CONCAT('%', #{searchWord}, '%') OR-->
<!--                ename LIKE CONCAT('%', #{searchWord}, '%') OR-->
<!--                deptname LIKE CONCAT('%', #{searchWord}, '%') OR-->
<!--                email LIKE CONCAT('%', #{searchWord}, '%')-->
<!--            </otherwise>-->
<!--        </choose>-->
<!--    </sql>-->


    <select id="getHrmTotal" resultType="int">
        SELECT COUNT(*) AS TOTAL FROM HRM
    </select>

<!--    <select id="getSearchHrmTotal" resultType="int" parameterType="HashMap">-->
<!--        select count(*) as total from HRM-->
<!--        <if test="search != null and searchWord != null">-->
<!--            where <include refid="search"></include>-->
<!--        </if>-->
<!--    </select>-->

    <select id="getSearchHrmTotal" resultType="int" parameterType="HashMap">
        select count(*) as total from HRM
        <if test="search != null and searchWord != null">
            WHERE empno LIKE CONCAT('%', #{searchWord}, '%')
        </if>
    </select>

    <select id="getHrm" resultType="HrmDto" parameterType="HrmDto">
        SELECT * FROM HRM WHERE EMPNO = ${empNo}
    </select>

    <select id="getHrmList" resultType="HrmDto" parameterType="HrmPageDto">
        SELECT * FROM (
        SELECT *, ROW_NUMBER() OVER () AS num FROM HRM
        ) AS numbered_rows
        LIMIT #{start}, #{end}

    </select>

<!--    <select id="getSearchHrmList" resultType="HrmDto" parameterType="HrmPageDto">-->
<!--        SELECT * FROM (-->
<!--        SELECT *, ROW_NUMBER() OVER () AS num FROM HRM-->
<!--        ) AS numbered_rows-->
<!--        <if test="search != null and searchWord != null">-->
<!--            where <include refid="search"></include>-->
<!--        </if>-->
<!--        ) AS b01-->
<!--        LIMIT #{start}, #{end}-->
<!--    </select>-->

    <select id="getSearchHrmList" resultType="HrmDto" parameterType="HrmPageDto">
        SELECT * FROM (
        SELECT *, ROW_NUMBER() OVER () AS num FROM HRM
        ) AS numbered_rows
        <if test="search != null and searchWord != null">
            WHERE empno LIKE CONCAT('%', #{searchWord}, '%')
        </if>
        ) AS b01
        LIMIT #{start}, #{end}
    </select>

    <insert id="insertHrm" parameterType="HrmDto">
        INSERT INTO HRM (
        EMPNO, ENAME, FOREIGN_NAME, DEPTNO, DEPTNAME, POSITION, MOBILE, PASSPORT, EMAIL, HIREDATE, HIRETYPE, RESIGNDATE,
        OUTREASONS, BANK_NAME, ACCOUNT, ACCOUNT_HOLDER, POSTCODE, ADDRESS, ADDRESS_DETAIL, ORIGINAL_NAME, RENAME_NAME,
        ETC_FILE, REMARKS, POSITION_NO
        ) VALUES (
        #{empNo}, #{eName}, #{foreignName}, #{deptNo}, #{deptName}, #{position}, #{mobile}, #{passport}, #{email},
        #{hireDate}, #{hireType}, #{resignDate}, #{outReasons}, #{bankName}, #{account}, #{accountHolder}, #{postCode},
        #{address}, #{addressDetail}, #{originalName}, #{renameName}, #{etcFile}, #{remarks}, #{positionNo}
        )
    </insert>

    <update id="updateHrm" parameterType="HrmDto">
        UPDATE HRM
        SET
        ENAME = #{eName},
        FOREIGN_NAME = #{foreignName},
        DEPTNO = #{deptNo},
        DEPTNAME = #{deptName},
        POSITION = #{position},
        MOBILE = #{mobile},
        PASSPORT = #{passport},
        EMAIL = #{email},
        HIREDATE = #{hireDate},
        HIRETYPE = #{hireType},
        RESIGNDATE = #{resignDate},
        OUTREASONS = #{outReasons},
        BANK_NAME = #{bankName},
        ACCOUNT = #{account},
        ACCOUNT_HOLDER = #{accountHolder},
        POSTCODE = #{postCode},
        ADDRESS = #{address},
        ADDRESS_DETAIL = #{addressDetail},
        ORIGINAL_NAME = #{originalName},
        RENAME_NAME = #{renameName},
        ETC_FILE = #{etcFile},
        REMARKS = #{remarks},
        POSITION_NO = #{positionNo}
        WHERE EMPNO = #{empNo}
    </update>


</mapper>