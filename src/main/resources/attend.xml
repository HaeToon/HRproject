<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hrproject.hrproject.mybatis">

    <!-- 삭제 쿼리 추가 -->
    <delete id="deleteAttend" parameterType="String">
        DELETE FROM ATTEND WHERE ATDNO = #{atdNo}
    </delete>


    <sql id="searchCondition">
        <choose>
            <when test="search == 'empNo'">
                empNo LIKE CONCAT('%', #{searchWord}, '%')
            </when>
            <when test="search == 'atdNo'">
                atdNo LIKE CONCAT('%', #{searchWord}, '%')
            </when>
            <when test="search == 'ename'">
                ename LIKE CONCAT('%', #{searchWord}, '%')
            </when>
            <when test="search == 'atdCode'">
                atdCode LIKE CONCAT('%', #{searchWord}, '%')
            </when>
            <otherwise>
                empNo LIKE CONCAT('%', #{searchWord}, '%') OR
                atdNo LIKE CONCAT('%', #{searchWord}, '%') OR
                ename LIKE CONCAT('%', #{searchWord}, '%') OR
                atdCode LIKE CONCAT('%', #{searchWord}, '%')
            </otherwise>
        </choose>
    </sql>

    <select id="searchAttend" resultType="AttendDto">
        SELECT * FROM ATTEND
        <where>
            <include refid="searchCondition"/>
        </where>
    </select>

    <insert id="insertAttend" parameterType="AttendDto">
        INSERT INTO ATTEND (EMPNO, ATDNO, ENAME, ATDCODE, ATDNUM, ATDDATE, OFFDAY, OFFDAYRS, PRINT)
        VALUES (
        #{empNo}, <!--사원번호 -->
        #{atdNo}, <!--근태번호-->
        #{ename},<!--사원명-->
        #{atdCode}, <!--근태코드-->
        #{atdNum}, <!--근태수-->
        CONCAT(#{startAtdDate}, ' ~ ', #{endAtdDate}), <!--근태기간 시작~ 끝 -->
        #{offDay}, <!--휴가명-->
        #{offDayRs}, <!--휴가사유-->
        #{print} <!--인쇄-->
        )

    </insert>


    <select id="getAttendList" resultType="AttendDto">
        select * from attend
    </select>
    <select id="getUpdateInfo" resultType="AttendDto" parameterType="String">
        SELECT * FROM ATTEND WHERE ATDNO = #{selectName}
    </select>
    <update id="updateAttend" parameterType="AttendDto">
        UPDATE ATTEND
        SET
        ATDNUM = #{atdNum},
        ATDDATE = #{atdDate},
        OFFDAY = #{offDay},
        OFFDAYRS = #{offDayRs},
        ATDCODE = #{atdCode},
        PRINT = #{print}
        WHERE
        EMPNO = #{empNo} AND
        ATDNO = #{atdNo}
    </update>

    <!--adtNo 예외처리-->
    <select id="countByAtdNo" resultType="int" parameterType="java.lang.String" >
        SELECT COUNT(*) FROM ATTEND WHERE ATDNO = #{atdNo}
    </select>

    <!--empNo 예외처리-->
    <select id="countByEmpNo" resultType="int" parameterType="java.lang.String" >
        SELECT COUNT(*) FROM HRM WHERE EMPNO = #{empNo}
    </select>
</mapper>